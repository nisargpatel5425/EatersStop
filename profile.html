<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Home</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="css/star.css" rel="stylesheet">
  <style type="text/css">
    .cardview{
      width: 40%;
    }
    .space{
      margin-top:50px;
    }
    .collapsible-body{
      padding-top: 0px
    }
    #profileImage{
      /*position: relative;*/
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: #5cb7ae;
      font-size: 35px;
      color: #fff;
      text-align: center;
      line-height: 150px;
      margin: 20px 39%;
    }
  </style>
</head>
<body>
<!-- parallax -->


 



<nav style="opacity: 0.8;height:90px">
    <div class="nav-wrapper " style="background: #5cb7ae">
      <div href="#" class="brand-logo" style="margin-left:8%;display: block;font-size: 50px;font-family: 'Bubblegum Sans', cursive;">Eaters'Stop</div>
      <span style="font-size: 15px;margin-left: 12%;top: 40px;position: absolute;font-family: cursive;">Best Food Collection</span>
      <ul id="nav-mobile" class="right hide-on-med-and-down">

        <li><a onclick="testJS()">Profile</a></li>
         <li><a href="edit_menu.html">My Orders</a></li>
        <li><a href="invoice.html">Invoice</a></li>
        <li><a id="area2" href="sp_list.html"></a></li>
        
        <!-- <li><a id="area"></a></li> -->
        <!-- <li id="emailname"<li id="fname"></li>></li> -->
        <li id="fname"></li>
        <li><a onclick="logout()">Logout</a></li>
      </ul>
      <ul id="slide-out" class="side-nav">
      
        <!-- <li><a href="badges.html">Pay</a></li> -->
        <li><a onclick="testJS()">Profile</a></li>
        <li><a href="edit_menu.html">My Orders</a></li>
        <li><a href="invoice.html">Invoice</a></li>
        <li><a id="area2" href="sp_list.html"></a></li>

        <!-- <li><a id="area"></a></li> -->
        <!-- <li id="emailname"></li> -->
        <li id="fname"></li>

        <li><a onclick="logout()">Logout</a></li>
  </ul>
  <a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
  </nav>

<div class="row card" style="margin-top: 3%;margin-left:5%;margin-right: 5%; margin-bottom: 3%;box-shadow: 3px 3px 10px 1px;">
        <div class="col s6 m6 center" style="margin:5px;background-color: #f4f7f9">
          <!-- <img src="images/d.png" width="30%" height="30%" style="margin-top: 4%;"> -->
          <div id="profileImage"></div>

          <div class="card-title " id="servicename" style="margin-top: 10px;margin-bottom: 10%">Service Provider</div>
        </div>
        <div class="col s6 m5">
          <div class=" "> 
            <!-- grey lighten-3 -->
            <div class="card-content black-text" style="padding: 0% !important">
              <!-- <img src="" alt="Contact Person"> -->
              
              
              <div style="padding: 4%;">
              <table>
       

        <tbody>
          <tr >
            <td>Email</td>
            <td id="emailname1"></td>
          </tr>
          <tr>
            <td>Address </td>
            <td id="address"></td>
            
          </tr>
          <tr>
            <td>Area</td>
            <td id="area1"></td>
            
          </tr>
          <tr>
            <td>Date of Birth</td>
            <td id="dob"></td>
          </tr>
          <tr>
            <td>Total tiffins ordered</td>
            <td>50</td>
          
          </tr>
        </tbody>
      </table>
              
            </div>
            </div>
            </div>
            </div>
            
          </div>

<!-- <div class="row container"><div class="col s10"><div class="input-field"><input id="comment" type="text" class="validate"><label for="comment">Write your Comment</label></div></div><div><button class="btn waves-effect waves-light col s2" type="submit" name="action" style="margin-top: 21px;" onclick="writeComment()">Submit<i class="material-icons right">send</i></button></div></div></div> -->

<!-- <div class=" " style="margin-top: 4%;margin-left:5%;margin-right: 5%;box-shadow: 3px 3px 10px 1px;padding: 20px;margin-bottom: 4%">
  <div>
    <section class='rating-widget'>
      <div class='rating-stars text-center'>
        <ul id='stars'>
          <li class='star' title='Poor' data-value='1'>
            <i class='fa fa-star fa-fw'></i>
          </li>
          <li class='star' title='Fair' data-value='2'>
            <i class='fa fa-star fa-fw'></i>
          </li>
          <li class='star' title='Good' data-value='3'>
            <i class='fa fa-star fa-fw'></i>
          </li>
          <li class='star' title='Excellent' data-value='4'>
            <i class='fa fa-star fa-fw'></i>
          </li>
          <li class='star' title='WOW!!!' data-value='5'>
            <i class='fa fa-star fa-fw'></i>
          </li>
        </ul>
      </div>
    </section>
</div> -->

  <!-- <div class="row container"><div class="col s10"><div class="input-field"><input id="comment" type="text" class="validate"><label for="comment">Write your Comment</label></div></div><div><button class="btn waves-effect waves-light col s2" type="submit" name="action" style="margin-top: 21px;" onclick="writeComment()">Submit<i class="material-icons right">send</i></button></div></div>

 <h3 style="padding-bottom: 10px;margin-bottom: 10px; ">Comments</h3>
 <div id="manage_comment" class="">
  </div> 
  </div> -->


  <!-- footer -->
    <footer class="page-footer " style="background: #5cb7ae">
          <div class="container">
            <div class="row">
              <div class="col l4 offset-l2 s12">
                <h5 class="white-text">Links</h5>
                <ul>
                  <li><a class="grey-text text-lighten-3" href="#!">Contact Us</a></li>
                  <li><a class="grey-text text-lighten-3" href="#!">About Us</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="footer-copyright">
            <div class="container">
            <!-- Â© 2014 Copyright Text -->
            </div>
          </div>
        </footer>
      


  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
  <script type="text/javascript">
  $(document).ready(function(){
      $('select').material_select();  //dropdown
       $(".button-collapse").sideNav(); //nav-mobile
       $('.modal').modal();
       $('.collapsible').collapsible();
       
    });


</script>
<script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyA6qc5XKVuRKGIoG9ilyMxKb0LjDP8V-NM",
    authDomain: "tiffin-service-c75e3.firebaseapp.com",
    databaseURL: "https://tiffin-service-c75e3.firebaseio.com",
    projectId: "tiffin-service-c75e3",
    storageBucket: "tiffin-service-c75e3.appspot.com",
    messagingSenderId: "224722105482"
  }
  firebase.initializeApp(config);
</script>

<!-- Welcome user firebase -->
<script type="text/javascript">
var userEmail;
var userUid;
firebase.auth().onAuthStateChanged(function(user)
 {
  if (user) {
    // User is signed in.
    var user = firebase.auth().currentUser;
    userEmail = user.email;
    setname();
    comment_retrieve();
    // $("#emailname").html("Welcome "+user.email);
   // profile_retrieve();
  } else {
    window.open("index.html","_self");
    // No user is signed in.
  }
});

window.onload = function () {
    var url = document.location.href,
        params = url.split('?')[1].split('&'),
        data = {}, tmp;
    for (var i = 0, l = params.length; i < l; i++) {
         tmp = params[i].split('=');
         data[tmp[0]] = tmp[1];
}
   
    Uid =data.name;
    profile_retrieve();
}

function testJS() {
 
    var b = Uid;
        url = 'profile.html?name=' + encodeURIComponent(b);

    document.location.href = url;
}

function setname() {
  // body...
  firebase.database().ref('customer/').orderByChild("Email").equalTo(userEmail).on("value", function(snapshot)
    {

        snapshot.forEach(function(child)
        {

           var obj = child.val();
           // Uid = obj.Uid;
          userUid = obj.Uid;
           
           $("#fname").html("Welcome "+obj.Firstname);
           
        });
    });
}

function comment_retrieve() {
  // alert(Uid);
  firebase.database().ref('service_provider/'+Uid+'/comments/').on("value", function(snapshot)
    {
      $('#manage_comment').html("");
        snapshot.forEach(function(child)
        {

           var obj = child.val();
           var custUid = obj.Uid;
           var comment = obj.comment;
           var rating = obj.rating;

            firebase.database().ref('customer/'+custUid+'/').on("value", function(snapshot){
           var obj = snapshot.val();
           //alert(custUid);
           var Firstname =  obj.Firstname;

          $('#manage_comment').append("<div class=\"row \" style=\"border-bottom:2px solid #e4e2e2; padding-bottom: 10px \"><div class=\"col s1\" style=\"display: inline-block;\"><img src=\"images/d.png\" width=\"50px\"></div><div class=\"col s10 m8\" ><span class=\"card-title\" style=\"font-size: 20px\">"+comment+"</span><div style=\"padding-left: 5px;color: #666699\">"+Firstname+"</div></div></div>");
            });


           
           
        });  


        
});
}

var ratingValue=0;
function writeComment() {
    comment = $("#comment").val();
    if(ratingValue==0)
    {
      alert("Please select Rating value");
    }
    else
    {
      if(comment=="")
      {
        alert("Enter the comment");
      }
      else
      {
        firebase.database().ref('service_provider/'+Uid+'/comments/').push({
      
      
     comment: comment,
     Uid: userUid,
     rating: ratingValue
     });
      }
     $("#comment").val("");

    var stars = $('#stars li').parent().children('li.star');
    for (i = 0; i < stars.length; i++) {
      $(stars[i]).removeClass('selected');
    }
    ratingValue=0;
    

    }

     // alert(ratingValue);  
}





function profile_retrieve()
{

  firebase.database().ref('service_provider/').orderByChild("Uid").equalTo(Uid).on("value", function(snapshot)
    {
        if(snapshot.val())
        {
        snapshot.forEach(function(child)
        {

           var obj = child.val();
           // var servicename = obj.service_name;
           // var emailname = obj.Email;
           // var address = obj.address;
           // var area = obj.area;
           // var dob = obj.dob;
           // alert(emailname);
           $("#servicename").html(obj.service_name);
           $("#emailname1").html(obj.Email);
           $("#address").html(obj.address);
           $("#area2").html(obj.area);
           $("#area1").html(obj.area);
           $("#dob").html(obj.dob);
           
        });  
        }
        else{

          firebase.database().ref('customer/').orderByChild("Uid").equalTo(Uid).on("value", function(snapshot)
    {
        
        snapshot.forEach(function(child)
        {

           var obj = child.val();
           // var servicename = obj.service_name;
           // var emailname = obj.Email;
           // var address = obj.address;
           // var area = obj.area;
           // var dob = obj.dob;
           // alert(emailname);
           $("#servicename").html(obj.Firstname);
           $("#emailname1").html(obj.Email);
           $("#address").html(obj.Address1);
           $("#area").html(obj.Area);
           $("#area1").html(obj.Area);
           $("#dob").html(obj.Dob);
           
        });  
        
        
    });
        }
        
    });
  avatar();
}

function avatar() {

  
  firebase.database().ref('customer/').orderByChild("Uid").equalTo(Uid).on("value", function(snapshot)
    {
        
        snapshot.forEach(function(child)
        {

           var obj = child.val();
           
           var Firstname = obj.Firstname;
           var Lastname = obj.Lastname;
           var initials = Firstname.charAt(0)+""+Lastname.charAt(0);
           document.getElementById("profileImage").innerHTML = initials;
           // alert(Firstname);
           
        });  
        
        
    });

}







function logout() {
// alert("logout");
  firebase.auth().signOut().then(function() {
  // Sign-out successful.
  window.open("index.html","_self");
}).catch(function(error) {
  // An error happened.
});
  // body...
}





</script>
<script src="js/star.js"></script>

</body>
</html>